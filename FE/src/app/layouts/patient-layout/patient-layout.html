<header class="header shadow-sm sticky-top bg-white border-bottom">
  <div class="container d-flex align-items-center justify-content-between py-2">

    <a routerLink="/" class="d-flex align-items-center text-decoration-none text-primary">
      <i class="bi bi-heart-pulse-fill fs-4"></i>
      <span class="fs-4 ms-2 fw-bold text-dark">Healthcare</span>
    </a>

    <ul class="nav align-items-center mb-0">
      <li class="nav-item">
        <a routerLink="/" routerLinkActive="text-primary fw-semibold" [routerLinkActiveOptions]="{ exact: true }"
          class="nav-link px-3 text-dark">Nhà thuốc</a>
      </li>
      <li class="nav-item">
        <a routerLink="/products" routerLinkActive="text-primary fw-semibold" class="nav-link px-3 text-dark">
          Sản phẩm
        </a>
      </li>
      <li class="nav-item">
        <a (click)="handleProtectedLink('/appointments')" class="nav-link px-3 text-dark" style="cursor: pointer;">
          Đặt lịch hẹn
        </a>
      </li>
      <li class="nav-item">
        <a (click)="handleProtectedLink('/records')" class="nav-link px-3 text-dark" style="cursor: pointer;">
          Hồ sơ bệnh án
        </a>
      </li>
    </ul>

    <div class="search-box me-3 flex-grow-1" style="max-width: 260px;">
      <input type="search" class="form-control form-control-sm rounded-pill px-3"
             placeholder="Tìm kiếm thuốc..." aria-label="Search" />
    </div>

    <div class="cart-container position-relative me-4"
     (mouseenter)="toggleCartPreview(true)"
     (mouseleave)="toggleCartPreview(false)"
     style="cursor: pointer;">
  
  <div class="cart-icon position-relative d-flex align-items-center" (click)="handleProtectedLink('/cart')">
    <i class="bi bi-cart3 fs-4 text-primary"></i>
    
    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
          *ngIf="authService.isAuthenticated() && cartService.getTotalQuantity() > 0">
      {{ cartService.getTotalQuantity() }}
    </span>
  </div>

  <div class="cart-dropdown position-absolute bg-white shadow rounded p-3"
       [class.show]="showCartPreview"
       style="width: 300px; right: 0; top: 120%; z-index: 2000;">
    <h6 class="fw-bold mb-2">Giỏ hàng</h6>

    <ng-container *ngIf="authService.isAuthenticated(); else loggedOutCartView">

      <div *ngIf="cartService.getCart().length === 0"
           class="text-muted small text-center py-2">
        Chưa có sản phẩm nào.
      </div>

      <ul class="list-unstyled mb-2"
          *ngIf="cartService.getCart().length > 0"
          style="max-height: 250px; overflow-y: auto;">
        <li *ngFor="let item of cartService.getCart()"
            class="d-flex justify-content-between align-items-center border-bottom py-2 small">
          <div class="d-flex flex-column">
            <span class="fw-medium">{{ item.productName }}</span>
            <small class="text-muted">SL: {{ item.quantity }}</small>
          </div>
          <span class="text-primary fw-semibold">
            {{ (item.price * item.quantity) | currency:'VND':'symbol':'1.0-0' }}
          </span>
        </li>
      </ul>

      <div *ngIf="cartService.getCart().length > 0" class="text-center mt-2">
        <button class="btn btn-sm btn-outline-primary w-100"
                (click)="handleProtectedLink('/cart'); toggleCartPreview(false)">
          Xem giỏ hàng
        </button>
      </div>
      
    </ng-container>

    <ng-template #loggedOutCartView>
      <div class="text-muted small text-center py-2">
        Vui lòng đăng nhập để xem giỏ hàng.
      </div>
    </ng-template>

  </div>
</div>

    <div *ngIf="!authService.isAuthenticated()" class="text-end">
      <button type="button" class="btn btn-primary btn-sm" (click)="isAuthModalOpen = true">
        Đăng nhập / Đăng ký
      </button>
    </div>

    <div *ngIf="authService.isAuthenticated()" class="dropdown text-end">
      <a href="#" class="d-block text-dark text-decoration-none dropdown-toggle"
         data-bs-toggle="dropdown" aria-expanded="false">
        <i class="bi bi-person-circle fs-4"></i>
      </a>
      <ul class="dropdown-menu text-small dropdown-menu-end shadow-sm">
        <li>
          <a class="dropdown-item" (click)="router.navigate(['/my-appointments'])" style="cursor: pointer;">
            <i class="bi bi-calendar2-check me-2"></i> Lịch hẹn của tôi
          </a>
        </li>
        <li><a class="dropdown-item" href="#"><i class="bi bi-card-list me-2"></i> Đơn hàng của tôi</a></li>
        <li><a class="dropdown-item" href="#"><i class="bi bi-person-fill me-2"></i> Hồ sơ của tôi</a></li>
        <li><hr class="dropdown-divider" /></li>
        <li>
          <a class="dropdown-item text-danger" (click)="logout()" style="cursor: pointer;">
            <i class="bi bi-box-arrow-right me-2"></i> Đăng xuất
          </a>
        </li>
      </ul>
    </div>
  </div>
</header>

<main class="pt-3">
  <router-outlet></router-outlet>
</main>

<div class="container-fluid bg-light border-top mt-5">
  <div class="container">
    <footer class="row row-cols-1 row-cols-sm-2 row-cols-md-5 py-5">
      <div class="col mb-3">
        <a
          routerLink="/"
          class="d-flex align-items-center mb-3 link-body-emphasis text-decoration-none"
        >
          <i class="bi bi-heart-pulse-fill fs-4 text-primary me-2"></i>
          <span class="fs-4 fw-bold">Healthcare</span>
        </a>
        <p class="text-body-secondary">© 2025 Healthcare</p>
      </div>

      <div class="col mb-3"></div>

      <div class="col mb-3">
        <h5>Chức năng</h5>
        <ul class="nav flex-column">
          <li class="nav-item mb-2">
            <a routerLink="/" class="nav-link p-0 text-body-secondary">Nhà thuốc</a>
          </li>
          <li class="nav-item mb-2">
            <a (click)="handleProtectedLink('/appointments')" class="nav-link p-0 text-body-secondary" style="cursor: pointer">
              Đặt lịch hẹn
            </a>
          </li>
          <li class="nav-item mb-2">
            <a (click)="handleProtectedLink('/records')" class="nav-link p-0 text-body-secondary" style="cursor: pointer">
              Hồ sơ bệnh án
            </a>
          </li>
        </ul>
      </div>

      <div class="col mb-3">
        <h5>Hỗ trợ</h5>
        <ul class="nav flex-column">
          <li><a href="#" class="nav-link p-0 text-body-secondary">Liên hệ</a></li>
          <li><a href="#" class="nav-link p-0 text-body-secondary">Câu hỏi (FAQs)</a></li>
          <li><a href="#" class="nav-link p-0 text-body-secondary">Về chúng tôi</a></li>
        </ul>
      </div>

      <div class="col mb-3">
        <h5>Chính sách</h5>
        <ul class="nav flex-column">
          <li><a href="#" class="nav-link p-0 text-body-secondary">Chính sách bảo mật</a></li>
          <li><a href="#" class="nav-link p-0 text-body-secondary">Điều khoản sử dụng</a></li>
          <li><a href="#" class="nav-link p-0 text-body-secondary">Chính sách đổi trả</a></li>
        </ul>
      </div>
    </footer>
  </div>
</div>
<app-auth-modal *ngIf="isAuthModalOpen" (closeModal)="isAuthModalOpen = false"></app-auth-modal>