<div class="page-container">
  <!-- HEADER giống ảnh -->
  <div class="page-header mb-4" data-aos="fade-down">
    <div class="header-content">
      <div class="header-icon">
        <i class="bi bi-calendar-check-fill"></i>
      </div>
      <div class="header-text">
        <h1 class="page-title">Bệnh Án của tôi</h1>
        <p class="page-subtitle">Xem bệnh án theo từng cuộc hẹn khám</p>
      </div>
    </div>
  </div>

  <div class="content-card">
    <div *ngIf="isLoading" class="text-center p-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Đang tải...</span>
      </div>
    </div>

    <div *ngIf="!isLoading">
      <div>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>STT</th>
                <th>Thời gian khám</th>
                <th>Bác sĩ</th>
                <th>Chi nhánh</th>
                <th>Trạng thái</th>
                <th>Chẩn đoán</th>
                <th class="text-center">Tác vụ</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of records; let i = index">
                <td>{{ i + 1 }}</td>
                <td>
                  <span class="fw-bold">{{ r.appointment.appointmentTime | date:'dd/MM/yyyy HH:mm' }}</span>
                </td>
                <td>
                  <div class="fw-bold">{{ r.appointment.doctor.fullName }}</div>
                </td>
                <td>{{ r.appointment.branch.branchName }}</td>
                <td>
                  <span [ngSwitch]="r.appointment.status">
                    <span *ngSwitchCase="'CONFIRMED'" class="badge bg-success">Đã xác nhận</span>
                    <span *ngSwitchCase="'PENDING'" class="badge bg-warning text-dark">Chờ xác nhận</span>
                    <span *ngSwitchCase="'COMPLETED'" class="badge bg-primary">Đã hoàn thành</span>
                    <span *ngSwitchCase="'CANCELED'" class="badge bg-danger">Đã hủy</span>
                    <span *ngSwitchCase="'PENDING_PAYMENT'" class="badge bg-secondary">Chờ thanh toán</span>
                    <span *ngSwitchCase="'PENDING_BILLING'" class="badge bg-info">Chờ thanh toán dịch vụ</span>
                    <span *ngSwitchCase="'PAID_SERVICE'" class="badge bg-success">Đã thanh toán dịch vụ</span>
                    <span *ngSwitchDefault class="badge bg-light text-dark">{{ r.appointment.status }}</span>
                  </span>
                </td>
                <td class="notes-cell">
                  {{ r.diagnosis }}
                </td>
                <td class="text-center">
                  <button class="btn btn-sm btn-outline-primary" (click)="viewDetail(r.medicalRecordId)">
                    <i class="bi bi-eye"></i> Xem chi tiết bệnh án
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
       <!-- Pagination: luôn hiển thị kể cả chỉ có 1 trang -->
        <nav class="mt-4 d-flex justify-content-center">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="page === 0">
              <a class="page-link" href="#" (click)="goToPage(page - 1); $event.preventDefault()">Trước</a>
            </li>
            <ng-container *ngFor="let p of [].constructor(totalPages); let i = index">
              <li class="page-item" [class.active]="i === page">
                <a class="page-link" href="#" (click)="goToPage(i); $event.preventDefault()">{{ i + 1 }}</a>
              </li>
            </ng-container>
            <li class="page-item" [class.disabled]="page === totalPages - 1">
              <a class="page-link" href="#" (click)="goToPage(page + 1); $event.preventDefault()">Sau</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <!-- Dialog xem chi tiết bệnh án -->
  <app-medical-record-detail-dialog
    [record]="selectedRecord"
    [open]="isDialogOpen"
    (close)="closeDetailDialog()">
  </app-medical-record-detail-dialog>
</div>